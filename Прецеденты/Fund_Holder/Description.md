# Описание прецедента: Принятие решения держателем фонда

## Рамки
Система управления грантами GrantSystem.

## Уровень
Задача, определённая пользователем.

## Основной исполнитель (актёр)
Держатель фонда (пользователь системы).

## Заинтересованные лица и их требования
- **Держатель фонда (актёр)** — хочет зафиксировать итоговое решение по заявке с указанием результата и суммы гранта.
- **Класс домена `FundHolder`** — должен инкапсулировать бизнес-логику формирования решения и взаимодействия с заявкой.
- **Соискатель** — хочет получить финальный статус по своей заявке.
- **Эксперты** — ожидают, что их оценки будут учтены при принятии решения (в текущем коде это явно не проверяется).
- **Система** — должна корректно прикрепить решение к заявке, изменить статус и зафиксировать факт операции.

## Предусловия
- Держатель фонда (пользователь) идентифицирован и аутентифицирован в системе.
- В системе существует заявка (`Application`), доступная для принятия решения.
- Доступен прикладной сервис `GrantSystemService` с операцией `MakeDecision`.
- Доступен доменный объект `FundHolder`, соответствующий текущему пользователю.
- Оценки экспертов (`Evaluation`) могут существовать, но в текущей реализации не требуются для вызова операции.

## Результаты (постусловия)
- К заявке прикреплено решение (`GrantDecision`) с полями `Result`, `GrantAmount`, `Report`.
- Статус заявки изменён на «Решение принято».
- Выполнено логирование факта принятия решения (через `Console.WriteLine`).
- В памяти доменной модели заявка (`Application`) и её решение (`GrantDecision`) находятся в согласованном состоянии.

## Основной успешный сценарий
1. Держатель фонда в пользовательском интерфейсе выбирает конкретную заявку из списка доступных и вводит:
   - текст результата (`result`),
   - сумму гранта (`grantAmount`).
2. UI-слой (`Program`) формирует обращение к прикладному сервису:
   `GrantSystemService.MakeDecision(app, fundHolder, result, grantAmount)`.
3. `GrantSystemService` делегирует выполнение операции доменному объекту:
   `FundHolder.MakeDecision(app, result, grantAmount)`.
4. Метод `FundHolder.MakeDecision(...)` создаёт объект `GrantDecision` с полями:
   - `Result = result`,
   - `GrantAmount = grantAmount`,
   - `Report = $"Решение от: {Fio}"`.
5. `FundHolder` прикрепляет решение к заявке вызовом:
   `Application.AttachDecision(decision)`.
6. Метод `Application.AttachDecision(decision)`:
   - сохраняет ссылку на объект `GrantDecision` в поле `Decision`,
   - изменяет статус заявки на «Решение принято».
7. В ходе выполнения операции производится логирование в консоль о том, что держатель фонда принял решение по указанной заявке.
8. `GrantSystemService` возвращает управление вызывающей стороне (UI), интерфейс отображает обновлённый статус заявки и информацию о принятом решении.

## Специальные требования (по текущей реализации)
- Операция прикрепления решения и изменения статуса заявки выполняется как единое действие в рамках одного вызова (`AttachDecision`).
- Логирование осуществляется через стандартный вывод (`Console.WriteLine`).
- Строка отчёта (`Report`) формируется автоматически на основе доменного свойства `FundHolder.Fio`.
- Валидация значений `result` и `grantAmount` не выполняется — переданные значения принимаются без проверки.
- Статус заявки до вызова операции явно не проверяется (можно вызвать `MakeDecision` в любом статусе).

## Список технологий и типов данных
- Язык реализации: C# / .NET.
- Прикладной слой:
  - `GrantSystemService.MakeDecision(Application app, FundHolder holder, string result, decimal grantAmount)`.
- Доменный слой:
  - `class FundHolder { Guid Id; string Fio; void MakeDecision(Application app, string result, decimal grantAmount); }`
  - `class GrantDecision { Guid Id; string Title; string Result; decimal GrantAmount; string Report; }`
  - `class Application { ...; void AttachDecision(GrantDecision dec); }`
- Статусы заявки (по текущей модели):  
  «Черновик» → «Подана» → «На проверке» → «Решение принято».

## Частота использования
Выполняется один раз для каждой заявки в момент финализации рассмотрения (или повторно, если система разрешит переопределять решение).
